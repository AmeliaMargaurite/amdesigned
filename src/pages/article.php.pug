extends ../mixins/page_layout.pug
include ../components/article-schema-json.pug

block phpScripts
	<?php include_once('./load_article.php') ?>

block variables
	- var pageClass = "<?= $article ? 'article' : 'no-article' ?>";
	- var title = "<?= $article ? $article->title : 'Whoops!' ?>";
	- var page_description = "<?= $article ? $article->summary : 'Whoops' ?> ";
	- var slug = "article/<?= $article ? $article->slug : '' ?>";
	- var page_image = "<?= $article ? $img_path . 'medium/' . $article->hero_img_filename . '.jpg' : '' ?>";
	- var page_image_alt = "<?= $article ? $article->hero_img_alt : ''?>";

block content
	<?php if ($article !== null) :?>
		span.hero_img
			<?php $sizes = ['small/' => '425w', 'medium/' => '900w', 'large/' => '1024w', 'xLarge/' => '1440w'] ?>
			<?php $webp_srcset = buildSrcsets($img_path, $article->hero_img_filename, $sizes, '.webp') ?>
			<?php $jpg_srcset = buildSrcsets($img_path, $article->hero_img_filename, $sizes, '.jpg') ?>
			- var img_height = "400px";
			figure.image-w-placeholder
				img.placeholder-image(
					src!="<?= $img_path . 'thumbnail/' . $article->hero_img_filename ?>.jpg",
					width="100%",
					height=img_height,
					style=`height: ${img_height} !important`
				)
				picture
					source(
						srcset!="<?= $webp_srcset ?>",
						type="image/webp",
						width="100%",
						height=img_height
					)
					img(
						sizes="(max-width: 1400px) 100vw, 1400px",
						srcset!="<?= $jpg_srcset ?>",
						src!="<?= $img_path . 'medium/' . $article->hero_img_filename ?>.jpg",
						alt!="<?= $article->hero_img_alt ?>",
						width="100%",
						height=img_height,
						style=`height: ${img_height} !important`
					)
		section.article__section
			span.section__content
				span.breadcrumbs
					span: a(href="/") home
					span #{ '>' }
					span: a(href="/articles") articles
					span #{ '>' }
					span.current!= "<?= strtolower($article->title) ?>"
				span.title__wrapper
					<?php $date = new DateTime($article->updated_at); ?>
					span.title
						h1!= "<?= $article->title?>"
					span.last_updated Last updated
						!= " <?= $date->format('jS F Y') ?>"
				//- span#summary 
				//- span.tags
				//- 	span#content.content!= "<?= $article->tags?>"
				//- span.categories
				//- 	span.content!= "<?= $article->categories?>"
				span#content.article-content!= "<?= $article->content?>"
				span#published_at
				+article-schema-json
	<?php else : ?>
	section
		span.section__content
			span
				h1 Whoops
				p The article you were looking for doesn't seem to exist
	<?php endif ?>
